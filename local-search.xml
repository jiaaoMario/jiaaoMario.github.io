<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ·±å…¥Vue3 æºç -å“åº”å¼ç³»ç»Ÿ</title>
    <link href="/2022/05/29/%E6%B7%B1%E5%85%A5Vue3-%E6%BA%90%E7%A0%81-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    <url>/2022/05/29/%E6%B7%B1%E5%85%A5Vue3-%E6%BA%90%E7%A0%81-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¤§è¯H5ä¸Native</title>
    <link href="/2022/03/12/%E6%8F%AD%E7%A7%98H5%E4%B8%8ENative%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/"/>
    <url>/2022/03/12/%E6%8F%AD%E7%A7%98H5%E4%B8%8ENative%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/</url>
    
    <content type="html"><![CDATA[<p>åŒ—äº¬çš„ç–«æƒ…ååå¤å¤ï¼Œè‡³ä»Šå·²å–œæä¸¤æ¬¡å±…å®¶éš”ç¦» ğŸ‘¨ğŸ»â€ğŸ’»ã€‚å¥½åœ¨æœ€è¿‘ç‰ˆæœ¬è¿­ä»£å·²å®Œæˆï¼Œå¯ä»¥æŠ½å‡ºæ—¶é—´é™ä¸‹å¿ƒæ¥åšäº›æŠ€æœ¯æ‹“å±•ã€‚</p><h2 id="æœ¬æ–‡ä½ å°†äº†è§£åˆ°ä»€ä¹ˆï¼Ÿ"><a href="#æœ¬æ–‡ä½ å°†äº†è§£åˆ°ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æœ¬æ–‡ä½ å°†äº†è§£åˆ°ä»€ä¹ˆï¼Ÿ"></a>æœ¬æ–‡ä½ å°†äº†è§£åˆ°ä»€ä¹ˆï¼Ÿ</h2><p>æœ¬æ–‡å°†ä» hybrid çš„åŸºæœ¬æ¶æ„å’Œæ··åˆå¼å¼€å‘çš„ç†è®ºå®ç°å…¥æ‰‹ï¼Œé€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œé˜ä¸‹å°†æœ‰æœºä¼šé€šè¿‡åˆ†æ JockeyJs çš„æºç ä»è€Œäº†è§£æ•´ä¸ª Hybrid çš„åŸç†ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-hybrid"><a href="#ä»€ä¹ˆæ˜¯-hybrid" class="headerlink" title="ä»€ä¹ˆæ˜¯ hybrid?"></a>ä»€ä¹ˆæ˜¯ hybrid?</h2><p>éšç€ç§»åŠ¨ç«¯è®¾å¤‡çš„å¤§è§„æ¨¡æ™®åŠï¼ŒHybrid å·²ç»æˆä¸ºäº†æœ€ä¸»æµçš„å¿«é€Ÿè¿­ä»£æ–¹æ¡ˆã€‚Hybrid åŸºäº H5 çš„çµæ´»çš„å¼€å‘æ¨¡å¼ï¼Œä¾‹å¦‚åµŒå…¥ App å†…ç½® webview ç»„ä»¶æ¡†æ¶å†…ï¼ŒåŠ ä»¥ Native æä¾›çš„éƒ¨åˆ†åŸç”Ÿèƒ½åŠ›ï¼Œä»è€Œç»™äºˆç”¨æˆ·æä¾›å¯åª²ç¾åŸç”Ÿ App çš„ä½¿ç”¨ä½“éªŒã€‚æˆ‘å¸åŸºé‡‘è‚¡ç¥¨äº¤æ˜“ App ä¾¿æ˜¯åŸºäºè¯¥æ¶æ„è¿›è¡Œå®è·µçš„ï¼Œå¹¶å°†å…¥é‡‘ç­‰æ ¸å¿ƒé¡µé¢ä½¿ç”¨ Hybrid å®ç°ï¼Œè¿è¡Œè‡³ä»Šä¸€ç›´ç¨³å®šå¹¶ä¿æŒäº†ä¼˜å¼‚çš„ç”¨æˆ·ä½“éªŒï¼Œå¯è§ï¼Œåœ¨æ— æ•°ä¸ªå®è·µä¸­ï¼ŒHybrid æ˜¯å€¼å¾—æˆ‘ä»¬ä¿¡èµ–çš„ã€‚</p><h2 id="hybrid-çš„è®¾è®¡æ–¹æ¡ˆ"><a href="#hybrid-çš„è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="hybrid çš„è®¾è®¡æ–¹æ¡ˆ"></a>hybrid çš„è®¾è®¡æ–¹æ¡ˆ</h2><ol><li>åŸºäº WebView å®¹å™¨ï¼Œé€šè¿‡ JsBridge å®ç° H5 ä¸ Native çš„äº¤äº’é€šè®¯ã€‚</li><li>ä½¿ç”¨ç¤¾åŒºå†…éƒ¨æä¾›çš„ Native UI æ–¹æ¡ˆï¼Œä¾‹å¦‚åˆ©ç”¨ React åœ¨ç¼–è¯‘æ—¶æ˜¯åŸºäº Virtual DOM ä¸ºåˆ‡å…¥ç‚¹,ä¼ é€’è‡³ Native å¹¶è¿›è¡ŒåŸç”Ÿæ¸²æŸ“ã€‚</li><li>å°ç¨‹åºæ–¹æ¡ˆï¼Œä¾‹å¦‚å¾®ä¿¡å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºã€‚</li></ol><p>æˆ‘å¸æ··åˆå¼å¼€å‘æ¶æ„é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§ï¼šWebView å®¹å™¨æ¶æ„ã€‚æ¥ä¸‹æ¥ä¸»è¦æ¢è®¨çš„ä¹Ÿä¸»è¦æ˜¯è¿™ä¸€æ¨¡å¼ã€‚</p><blockquote><p>å¤æœ‰ç‰›éƒç»‡å¥³é€šè¿‡é¹Šæ¡¥ç›¸è§ï¼Œä½ ä¾¬æˆ‘ä¾¬ã€‚ä»Šæœ‰ jsbridge æ¶ˆé™¤ Native ä¸ H5 éš”é˜‚ï¼Œå‰ç«¯åŒå­¦æŠ¢äº† Native åŒå­¦çš„æ´»:)</p></blockquote><p>Native å’Œ H5 çš„åŒå‘é€šè®¯æœºåˆ¶æ˜¯ hybrid æ··åˆå¼å¼€å‘æ ¸å¿ƒä¹‹å¤„ã€‚åœ¨ Native ä¸­ï¼Œä¸åŒçš„ç³»ç»Ÿå­˜åœ¨ç€ç»Ÿä¸€çš„ webview å†…åµŒç»„ä»¶ã€‚</p><h2 id="Webview"><a href="#Webview" class="headerlink" title="Webview"></a>Webview</h2><p>åœ¨ IOS ä¸ Android ä¸­ï¼ŒWebview å†…æ ¸æ˜¯ä¸åŒçš„ã€‚å³ä¾¿åœ¨ç›¸åŒçš„ç³»ç»Ÿä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„ç³»ç»Ÿï¼ŒWebview å†…æ ¸ä¹Ÿæœ‰å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚</p><p>ä¾‹å¦‚åœ¨ä½ç‰ˆæœ¬ Android ä¸­ä½¿ç”¨çš„æ˜¯ WebKit å†…æ ¸, åœ¨ Android é«˜ç‰ˆæœ¬ä¸­åˆ™æä¾› Chromium ä½œä¸ºç³»ç»Ÿ WebView çš„åº•å±‚å†…æ ¸æ”¯æŒã€‚</p><p>IOS æœ€å¼€å§‹ä½¿ç”¨çš„ä¸º UIwebViewï¼Œä½† UIwebview æ— è®ºæ˜¯åœ¨æ–°ç‰¹æ€§çš„æ”¯æŒåº¦ä¸Šæˆ–è€…é¡µé¢æ¸²æŸ“æ€§èƒ½ä¸Šéƒ½ä¸å°½å¦‚äººæ„ï¼Œå› æ­¤åç»­ IOS å‡çº§ä¸º WKWebView åšä¸ºå†…æ ¸ã€‚å› æ­¤éšç€ Native Webview å†…æ ¸çš„å‡çº§ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½ç±»ï¼Œä½¿å¾—æ— è®ºæ˜¯ç”¨æˆ·ä½“éªŒè¿˜æ˜¯åŠŸèƒ½æ¥è®²ï¼Œéƒ½æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p><h2 id="Jsbridge-ä¸-Native-çš„é€šè®¯åŸç†"><a href="#Jsbridge-ä¸-Native-çš„é€šè®¯åŸç†" class="headerlink" title="Jsbridge ä¸ Native çš„é€šè®¯åŸç†"></a>Jsbridge ä¸ Native çš„é€šè®¯åŸç†</h2><h3 id="H5-é€šçŸ¥-Native"><a href="#H5-é€šçŸ¥-Native" class="headerlink" title="H5 é€šçŸ¥ Native"></a>H5 é€šçŸ¥ Native</h3><ol><li>Api æ³¨å…¥ï¼šç”±äº Native ä¸º webview çš„æä¾›è€…ï¼Œå› æ­¤ Native åŒæ ·æ‹¥æœ‰ç€è·å– JavaScript ç¯å¢ƒä¸Šä¸‹æ–‡çš„è¶…èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡ webview æä¾›çš„æ–¹æ³•åœ¨ JavaScript æ‰§è¡Œç¯å¢ƒå†…æŒ‚è½½å…¨å±€å¯¹è±¡å’Œæ–¹æ¡ˆã€‚</li><li>ç½‘ç»œè¯·æ±‚æ‹¦æˆª: webview æä¾›äº†åè®®æ‹¦æˆª APIï¼Œä¾‹å¦‚ IOS ä¸Šçš„ shouldStartLoadWithRequest ä»¥åŠ Android ä¸Šçš„ shouldOverrideUrlLoadingã€‚å½“åŒ¹é…åˆ°ç‰¹å®šçš„æ‹¦æˆªè¯·æ±‚åï¼Œè§£ææ„å›¾è¿›è¡Œå“åº”ã€‚</li><li>ç‰¹å®š jsAPI æ‹¦æˆªï¼š Native é€šè¿‡æ‹¦æˆª WebView ä¸­ JavaScript æ‰§è¡Œçš„ prompt&#x2F;console&#x2F;alert æ“ä½œï¼Œè§£ææ„å›¾è¿›è¡Œå“åº”ï¼Œä½†æ”¹æ–¹å¼å¹¶ä¸ç¨³å®šã€‚</li></ol><p>ç›®å‰çš„ä¸»è¦æ‰‹æ®µæ˜¯é€šè¿‡ç¬¬äºŒç§æ–¹å¼ï¼šè¯·æ±‚æ‹¦æˆªå®ç°çš„ï¼Œæˆ‘å¸ä¹Ÿæ˜¯é€šè¿‡è¯¥æ‰‹æ®µè¿›è¡Œä¸šåŠ¡è·¨ç«¯äº¤äº’ã€‚</p><h3 id="Native-é€šçŸ¥-H5"><a href="#Native-é€šçŸ¥-H5" class="headerlink" title="Native é€šçŸ¥ H5"></a>Native é€šçŸ¥ H5</h3><p>æ­£å¦‚ä¸Šæ–‡æ‰€è®²ï¼ŒNative ä¸º H5 æä¾›äº†å®¿ä¸»å®¹å™¨ï¼šwebViewï¼Œå¹¶ä¸” webView ä¹Ÿè´´å¿ƒçš„æä¾›äº† API å¯ä»¥ç›´æ¥æ¥å…¥ JavaScript è¿è¡Œæ—¶ï¼Œæ‰§è¡Œ JavaScript ä»£ç é€»è¾‘ã€‚<br>IOS:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">webview.stringByEvaluatingJavaScriptFromString(<span class="hljs-string">&quot;JSBridge.trigger(&#x27;NativeCall&#x27;)&quot;</span>)<br></code></pre></td></tr></table></figure><p>Android:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">webView.loadUrl(<span class="hljs-string">&quot;javascript:JSBridge.trigger(&#x27;NativeCall&#x27;)&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="æ¢ç©¶-Jsbridge-çš„åº•å±‚å®ç°"><a href="#æ¢ç©¶-Jsbridge-çš„åº•å±‚å®ç°" class="headerlink" title="æ¢ç©¶ Jsbridge çš„åº•å±‚å®ç°"></a>æ¢ç©¶ Jsbridge çš„åº•å±‚å®ç°</h2><p>åœ¨æˆ‘å¸çš„æ··åˆå¼å¼€å‘å®è·µä¸­ï¼Œåœ¨é¡µé¢åŠ è½½é˜¶æ®µå¼•å…¥äº† Jockey åšä¸º jsBridge æ¡¥æ¥æ¡¥æ¢ï¼ŒJockey çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡è¯·æ±‚ç‰¹å®š scheme ä»è€Œé€šçŸ¥ Native ç«¯ï¼Œå¹¶åœ¨å…¨å±€æŒ‚è½½äº‹ä»¶ï¼Œç­‰å¾… Native çš„è§¦å‘ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†æ Jockey çš„æºç ï¼Œäº†è§£æ•´ä¸ªæ··åˆå¼å¼€å‘åº•å±‚åŸç†ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-Jockeyï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Jockeyï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Jockeyï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Jockeyï¼Ÿ</h3><p><a href="https://github.com/tcoulter/jockeyjs">Jockeyjs</a>æ˜¯ä¸€ä¸ªè¿æ¥ Native ä¸ H5 ä¹‹é—´çš„ jsBridgeï¼Œé€šè¿‡æ‹¦æˆªè¯·æ±‚çš„æ–¹å¼å®ç°é€šè®¯ã€‚ç”±äºä½œè€…å‰ç«¯å‡ºèº«ï¼Œæ‰€ä»¥å¯¹ Jockey æºç çš„è®¨è®ºä¸»è¦æ”¾åœ¨ JockeyJS ç±»ä¸Šã€‚</p><h3 id="Jockey-å®ç°çš„-API"><a href="#Jockey-å®ç°çš„-API" class="headerlink" title="Jockey å®ç°çš„ API"></a>Jockey å®ç°çš„ API</h3><p>Jockey è§£å†³äº†ç«¯ä¸ H5 çš„åŒå‘æ²Ÿé€šé—®é¢˜ï¼Œæä¾›äº†å››ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š</p><table><thead><tr><th>API</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>send</td><td>H5 è°ƒç”¨,å‘ Native å‘é€äº‹ä»¶è¯·æ±‚</td></tr><tr><td>on</td><td>H5 è°ƒç”¨ï¼Œæ³¨å†Œå…¨å±€å‡½æ•°ï¼Œä»¥ä¾¿ Native ä¸»åŠ¨è§¦å‘</td></tr><tr><td>tigger</td><td>Native è°ƒç”¨ï¼Œç”¨äºè§¦å‘ JavaScript æ³¨å†Œçš„æ–¹æ³•</td></tr><tr><td>triggerCallback</td><td>Native è°ƒç”¨ï¼Œå“åº” H5 è¯·æ±‚åï¼Œè§¦å‘ H5 å­˜å‚¨çš„å›è°ƒå‡½æ•°</td></tr></tbody></table><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¾¿ä¸»è¦ä»è¿™å‡ ä¸ª API å…¥æ‰‹ï¼Œç ”ç©¶ jockey æºç ã€‚</p><h4 id="IIFE-æ‰§è¡ŒæŒ‚è½½"><a href="#IIFE-æ‰§è¡ŒæŒ‚è½½" class="headerlink" title="IIFE æ‰§è¡ŒæŒ‚è½½"></a>IIFE æ‰§è¡ŒæŒ‚è½½</h4><p>Jockey æºç ä¸»è¦ç”±ä¸€ä¸ª IIFE å‡½æ•°ä½“ç»„æˆï¼Œåœ¨è¿›è¡Œäº†ä¸€äº›ç®€å•çš„ç¯å¢ƒåˆ¤æ–­åï¼Œå°† Jockey å¯¹è±¡æŒ‚è½½è‡³ window ä¸‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Javascript">;(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> host = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">host</span>;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>,<br>        iOS = <span class="hljs-literal">false</span>,<br>        iDevice = [<span class="hljs-string">&#x27;iPad&#x27;</span>, <span class="hljs-string">&#x27;iPhone&#x27;</span>, <span class="hljs-string">&#x27;iPod&#x27;</span>];<br><br>    <span class="hljs-keyword">for</span> (; i &lt; iDevice.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">platform</span>.<span class="hljs-title function_">indexOf</span>(iDevice[i]) &gt;= <span class="hljs-number">0</span>) &#123;<br>            iOS = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">UIWebView</span>  = <span class="hljs-regexp">/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);<br>    <span class="hljs-keyword">var</span> isAndroid  = navigator.<span class="hljs-property">userAgent</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;android&quot;</span>) &gt; -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// å¦‚æœåœ¨ Native ç¯å¢ƒä¸­ï¼Œå°† Jockey.dispatchers è¡¥å…… nativeDispatcher è§¦å‘å™¨</span><br>    <span class="hljs-keyword">if</span> ((iOS &amp;&amp; <span class="hljs-title class_">UIWebView</span>) || isAndroid) &#123;<br>        <span class="hljs-title class_">Jockey</span>.<span class="hljs-property">dispatchers</span>.<span class="hljs-title function_">push</span>(nativeDispatcher);<br>    &#125;<br><br>    <span class="hljs-title class_">Jockey</span>.<span class="hljs-property">dispatchers</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">IframeDispatcher</span>);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;message&quot;</span>, $.<span class="hljs-title function_">proxy</span>(<span class="hljs-title class_">Jockey</span>.<span class="hljs-property">onMessageRecieved</span>, <span class="hljs-title class_">Jockey</span>), <span class="hljs-literal">false</span>);<br><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">Jockey</span> = <span class="hljs-title class_">Jockey</span>;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„å‡½æ•°ä¸­å¼•ç”¨åˆ°äº† Jockeyã€nativeDispatcherã€IframeDispatcher å¯¹è±¡ï¼Œè¿™æ˜¯ä¸ºäº†æ›´ç›´è§‚çš„é˜…è¯»æºç ï¼Œå› æ­¤æŠ½ç¦»äº†å¤§éƒ¨åˆ†é€»è¾‘ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªä¸ªåˆ†æè¿™ä¸‰ä¸ªæ¨¡å—ï¼Œç†è§£æ•´ä¸ª Jockey çš„è®¾è®¡æ€è·¯ã€‚</p><h4 id="nativeDispatcher"><a href="#nativeDispatcher" class="headerlink" title="nativeDispatcher"></a>nativeDispatcher</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs javaScript"><span class="hljs-keyword">var</span> nativeDispatcher = &#123;<br>        <span class="hljs-comment">// è®¢é˜…å›è°ƒå‡½æ•°æ˜ å°„</span><br>        <span class="hljs-attr">callbacks</span>: &#123;&#125;,<br>        <span class="hljs-comment">// H5è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå®ç°å‘ Native å‘é€ä¿¡æ¯</span><br>        <span class="hljs-attr">send</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">envelope, complete</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dispatchMessage</span>(<span class="hljs-string">&quot;event&quot;</span>, envelope, complete);<br>        &#125;,<br><br>        <span class="hljs-comment">// å‘é€ callback å›è°ƒè‡³ Native ç”¨äº Native è§¦å‘å®ŒæˆåH5å›è°ƒé€šçŸ¥ Native</span><br>        <span class="hljs-attr">sendCallback</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">messageId</span>) &#123;<br>            <span class="hljs-keyword">var</span> envelope = <span class="hljs-title class_">Jockey</span>.<span class="hljs-title function_">createEnvelope</span>(messageId);<br><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dispatchMessage</span>(<span class="hljs-string">&quot;callback&quot;</span>, envelope, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;);<br>        &#125;,<br><br>        <span class="hljs-attr">triggerCallback</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) &#123;<br>            <span class="hljs-keyword">var</span> dispatcher = <span class="hljs-variable language_">this</span>;<br><br>            <span class="hljs-comment">// åŠ å…¥ setTimeout æ˜¯ä¸ºäº†é¿å… App å¡é¡¿ï¼Œå°†æ‰§è¡Œä»»åŠ¡åç½®åˆ°ä¸‹ä¸ªæ—¶é—´ç‰‡æ‰§è¡Œ</span><br>            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                dispatcher.<span class="hljs-property">callbacks</span>[id]();<br>            &#125;, <span class="hljs-number">0</span>);<br>        &#125;,<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * dispatchMessage æ–¹æ³•å®é™…ä¸Šæ˜¯å‘ Native å‘é€æ¶ˆæ¯çš„ä¸»è¦å®è·µè€…</span><br><span class="hljs-comment">         * é€šè¿‡æ‹¼æ¥ä¸€ä¸ªä»¥ jockeyä¸ºç‰¹æ®Šschemeè¯·æ±‚ï¼Œä½¿ Native è¿›è¡Œæ‹¦æˆªï¼Œå¯¹å‚æ•°è¿›è¡Œè§£æã€‚</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-attr">dispatchMessage</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">type, envelope, complete</span>) &#123;<br><br>            <span class="hljs-keyword">var</span> dispatcher = <span class="hljs-variable language_">this</span>;<br>            <span class="hljs-comment">// åœ¨æ‰§è¡Œå‘é€ä»»åŠ¡å‰ï¼Œå°†ä»»åŠ¡çš„å›è°ƒå‡½æ•°å­˜å‚¨ï¼Œç­‰å¾… Native å®Œæˆå“åº”åï¼Œè§¦å‘å›è°ƒä¾æ¬¡æ‰§è¡Œã€‚</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[envelope.<span class="hljs-property">id</span>] = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-title function_">complete</span>();<br><br>                <span class="hljs-keyword">delete</span> dispatcher.<span class="hljs-property">callbacks</span>[envelope.<span class="hljs-property">id</span>];<br>            &#125;;<br>          <span class="hljs-comment">// æ‹¼æ¥ä¼ é€’å‚æ•°ï¼Œé€šè¿‡åˆ›å»º Iframe å®ç°å‘é€è¯·æ±‚ï¼Œè¯·æ±‚å‘é€å®Œæ¯•åç§»é™¤ iframe</span><br>          <span class="hljs-keyword">var</span> src = <span class="hljs-string">&quot;jockey://&quot;</span> + type + <span class="hljs-string">&quot;/&quot;</span> + envelope.<span class="hljs-property">id</span> + <span class="hljs-string">&quot;?&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(envelope));<br>            <span class="hljs-keyword">var</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;iframe&quot;</span>);<br>            iframe.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;src&quot;</span>, src);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">appendChild</span>(iframe);<br>            iframe.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(iframe);<br>            iframe = <span class="hljs-literal">null</span>;<br>    &#125;<br>  &#125;;<br></code></pre></td></tr></table></figure><h4 id="IframeDispatcher"><a href="#IframeDispatcher" class="headerlink" title="IframeDispatcher"></a>IframeDispatcher</h4><p>IframeDispatcher å­˜åœ¨çš„æ„ä¹‰æ˜¯ä¿è¯åœ¨é Native ç¯å¢ƒä¸‹ï¼ŒJockeyjs ä¾æ—§å¯ä»¥ä¿æŒæ­£å¸¸è¿è½¬ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">IframeDispatcher</span> = &#123;<br>  <span class="hljs-attr">callbacks</span>: &#123;&#125;,<br><br>  <span class="hljs-attr">send</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">envelope, complete</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dispatchMessage</span>(<span class="hljs-string">&quot;jockeyEvent&quot;</span>, envelope, complete);<br>  &#125;,<br><br>  <span class="hljs-attr">sendCallback</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">messageId</span>) &#123;<br>    <span class="hljs-keyword">var</span> envelope = <span class="hljs-title class_">Jockey</span>.<span class="hljs-title function_">createEnvelope</span>(messageId);<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dispatchMessage</span>(<span class="hljs-string">&quot;jockeyCallback&quot;</span>, envelope, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;&#125;);<br>  &#125;,<br><br>  <span class="hljs-attr">triggerCallback</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id]) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id]();<br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-attr">dispatchMessage</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">type, envelope, complete</span>) &#123;<br>    <span class="hljs-keyword">var</span> dispatcher = <span class="hljs-variable language_">this</span>;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[envelope.<span class="hljs-property">id</span>] = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">complete</span>();<br><br>      <span class="hljs-keyword">delete</span> dispatcher.<span class="hljs-property">callbacks</span>[envelope.<span class="hljs-property">id</span>];<br>    &#125;;<br><br>    <span class="hljs-title class_">Jockey</span>.<span class="hljs-property">targetWindow</span>.<span class="hljs-title function_">postMessage</span>(<br>      &#123; <span class="hljs-attr">type</span>: type, <span class="hljs-attr">envelope</span>: envelope &#125;,<br>      <span class="hljs-title class_">Jockey</span>.<span class="hljs-property">targetDomain</span><br>    );<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="Jockey"><a href="#Jockey" class="headerlink" title="Jockey"></a>Jockey</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Jockey</span> = &#123;<br>  <span class="hljs-attr">listeners</span>: &#123;&#125;,<br>  <span class="hljs-comment">// ç”¨äºå­˜æ”¾ä¸åŒçš„è§¦å‘å™¨</span><br>  <span class="hljs-attr">dispatchers</span>: [],<br>  <span class="hljs-comment">// message åç§» ç”¨äºæ ‡è¯†äº‹ä»¶å”¯ä¸€ id</span><br>  <span class="hljs-attr">messageCount</span>: <span class="hljs-number">0</span>,<br><br>  <span class="hljs-attr">targetDomain</span>: <span class="hljs-string">&quot;*&quot;</span>,<br><br>  <span class="hljs-attr">targetWindow</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>,<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Jockey.on å®é™…çš„ç›‘å¬æ–¹æ³•</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">on</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">type, fn</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<br>      !<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">hasOwnProperty</span>(type) ||<br>      !<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span><br>    ) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] = [];<br>    &#125;<br>    <span class="hljs-comment">// æ³¨å†Œç›‘å¬å‡½æ•°</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type].<span class="hljs-title function_">push</span>(fn);<br>  &#125;,<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Jockey.on å®é™…çš„ç§»é™¤ç›‘å¬æ–¹æ³•</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">off</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<br>      !<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">hasOwnProperty</span>(type) ||<br>      !<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span><br>    ) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] = [];<br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] = [];<br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Jockey.send H5å‘ Native å‘é€è¯·æ±‚</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">send</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">type, payload, complete</span>) &#123;<br>    <span class="hljs-comment">//   å‚æ•°å¤„ç†</span><br>    <span class="hljs-keyword">if</span> (payload <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Function</span>) &#123;<br>      complete = payload;<br>      payload = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    payload = payload || &#123;&#125;;<br>    complete = complete || <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;&#125;;<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªåŒ…è£…äº‹ä»¶</span><br>    <span class="hljs-keyword">var</span> envelope = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createEnvelope</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">messageCount</span>, type, payload);<br>    <span class="hljs-comment">// è°ƒç”¨ä¸åŒç¯å¢ƒçš„è§¦å‘å™¨ï¼Œsend äº‹ä»¶</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dispatchers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">dispatcher</span>) &#123;<br>      dispatcher.<span class="hljs-title function_">send</span>(envelope, complete);<br>    &#125;);<br>    <span class="hljs-comment">// å¢åŠ åç§»ï¼Œä¿è¯ id ä¸åŒ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageCount</span> += <span class="hljs-number">1</span>;<br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Native é€šè¿‡è°ƒç”¨è¯¥æ–¹æ³• å‘ H5å‘é€æ¶ˆæ¯</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">trigger</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">type, messageId, json</span>) &#123;<br>    <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-comment">// è·å– H5 é€šè¿‡ Jockey.on æ³¨å†Œçš„äº‹ä»¶ç›‘å¬</span><br>    <span class="hljs-keyword">var</span> listenerList = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[type] || [];<br><br>    <span class="hljs-keyword">var</span> executedCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// H5åœ¨ Native tigger åé€šçŸ¥ Native æˆ‘æ–¹å·²å®Œæˆå›è°ƒå‡½æ•°çš„æ‰§è¡Œ</span><br>    <span class="hljs-keyword">var</span> complete = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      executedCount += <span class="hljs-number">1</span>;<br><br>      <span class="hljs-keyword">if</span> (executedCount &gt;= listenerList.<span class="hljs-property">length</span>) &#123;<br>        self.<span class="hljs-property">dispatchers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">dispatcher</span>) &#123;<br>          dispatcher.<span class="hljs-title function_">sendCallback</span>(messageId);<br>        &#125;);<br>      &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>; index &lt; listenerList.<span class="hljs-property">length</span>; index++) &#123;<br>      <span class="hljs-keyword">var</span> listener = listenerList[index];<br><br>      <span class="hljs-comment">// æ£€æŸ¥å½“å‰ç›‘å¬å‡½æ•°å‚æ•°ï¼Œå¦‚æœä¸ºä¸€ä¸ªï¼Œåˆ™ç›´æ¥è§¦å‘completeå›è°ƒ</span><br>      <span class="hljs-comment">// å¦‚æœä¸ºä¸¤ä¸ª åˆ™æ‰‹åŠ¨è§¦å‘å›è°ƒ</span><br>      <span class="hljs-keyword">if</span> (listener.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-title function_">listener</span>(json);<br>        <span class="hljs-title function_">complete</span>();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">listener</span>(json, complete);<br>      &#125;<br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * H5ç»è¿‡ Nativeè§¦å‘ï¼Œå®Œæˆå“åº”åé€šçŸ¥ Native</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-attr">triggerCallback</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dispatchers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">dispatcher</span>) &#123;<br>      dispatcher.<span class="hljs-title function_">triggerCallback</span>(id);<br>    &#125;);<br>  &#125;,<br><br>  <span class="hljs-attr">restrictIframeDispatcher</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">targetDomain, targetWindow</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetDomain</span> = targetDomain;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetWindow</span> = targetWindow;<br>  &#125;,<br><br>  <span class="hljs-attr">onMessageRecieved</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">targetDomain</span> != <span class="hljs-string">&quot;*&quot;</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetDomain</span> != event.<span class="hljs-property">origin</span>) &#123;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> envelope = event.<span class="hljs-property">data</span>.<span class="hljs-property">envelope</span>;<br>    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;jockeyEvent&quot;</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">trigger</span>(envelope.<span class="hljs-property">type</span>, envelope.<span class="hljs-property">id</span>, envelope.<span class="hljs-property">payload</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;jockeyCallback&quot;</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerCallback</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">envelope</span>.<span class="hljs-property">id</span>);<br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ç”Ÿæˆäº‹ä»¶å•å…ƒ</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">createEnvelope</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">id, type, payload</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">id</span>: id,<br>      <span class="hljs-attr">type</span>: type,<br>      <span class="hljs-attr">host</span>: host,<br>      <span class="hljs-attr">payload</span>: payload,<br>    &#125;;<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨åˆ†æ JockeyJs æºç åï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹é€šè¿‡æ‹¦æˆªè¯·æ±‚æ–¹å¼å®ç°çš„ Jsbridge çš„æµç¨‹ï¼š</p><ul><li><p>H5 é€šçŸ¥ Native<br>é€šè¿‡ <strong>Jockey.send</strong> æ–¹æ³•ï¼Œåˆ›å»º iframe,å‘é€ç‰¹å®šè¯·æ±‚ã€‚å¦‚æœæœ‰å›è°ƒå‡½æ•°ï¼Œåˆ™æ ¹æ® id å­˜å‚¨è‡³ callbacks å›è°ƒå¯¹è±¡ä¸­ï¼Œç­‰å¾… Native æ¥æ”¶åè§¦å‘<strong>triggerCallback</strong>æ–¹æ³•ä¾æ¬¡æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p></li><li><p>Native é€šçŸ¥ H5<br>é¦–å…ˆï¼ŒH5éœ€è¦é€šè¿‡ <strong>Jockey.on</strong> æ‰‹åŠ¨åœ¨Jokey å…¨å±€ä¸Šç»‘å®šç›‘å¬äº‹ä»¶ã€‚å¾… Native éœ€è¦é€šçŸ¥æ—¶ï¼Œåœ¨è·å– JavaScript è¿è¡Œæ—¶åï¼Œè°ƒç”¨æŒ‚è½½åœ¨å…¨å±€çš„ <strong>Jockey.tigger</strong> æ–¹æ³•ï¼Œè§¦å‘ä¹‹å‰ç»‘å®šçš„ç›‘å¬å¯¹è±¡,å¾…äº‹ä»¶æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡è°ƒç”¨<strong>sendCallback</strong>æ–¹æ³•é€šçŸ¥è‡³ Nativeã€‚</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>hybrid</tag>
      
      <tag>æ··åˆå¼å¼€å‘</tag>
      
      <tag>JockeyJS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥Vue3 æºç  - å¼€ç¯‡</title>
    <link href="/2022/02/12/%E6%B7%B1%E5%85%A5Vue3%20%E6%BA%90%E7%A0%81%20-%20%E5%BC%80%E7%AF%87/"/>
    <url>/2022/02/12/%E6%B7%B1%E5%85%A5Vue3%20%E6%BA%90%E7%A0%81%20-%20%E5%BC%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><p>Vue3 æ­£å¼ç‰ˆæœ¬å‘å¸ƒå·²ç»ä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘å¸ä¹Ÿå·²ç»å…¨é¢æ‹¥æŠ± Vue3ï¼Œç¬”è€…ä½¿ç”¨ v3 ç‰ˆæœ¬å‚ä¸æ¨åŠ¨äº†éƒ¨é—¨é‡è¦é¡¹ç›®çš„é‡æ„å‡çº§å·¥ä½œã€‚composition api ç­‰æ–°å¢ç‰¹æ€§åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„å´­æ–°ä½“éªŒã€‚å› æ­¤ï¼Œè¿™ä¿ƒä½¿ç¬”è€…æƒ³è¦å¯¹ Vue3 åº•å±‚åŸç†è¿›è¡Œä¸€æ¬¡æ·±åº¦å‰–æã€‚å¸Œæœ›å¯ä»¥é€šè¿‡è¯¥ç³»åˆ—æ–‡ç« å’Œè¯»è€…æ·±å…¥ Vue3 åº•å±‚å®ç°ï¼Œæé«˜å¼€å‘æ°´å¹³ã€‚</p><h2 id="çŸ¥è¯†å‚¨å¤‡"><a href="#çŸ¥è¯†å‚¨å¤‡" class="headerlink" title="çŸ¥è¯†å‚¨å¤‡"></a>çŸ¥è¯†å‚¨å¤‡</h2><p>å°±ç¬”è€…ä¸ªäººç»éªŒæ¥è®²ï¼Œå­¦ä¹ æºç çš„è¿‡ç¨‹å¾€å¾€æ˜¯æ¯ç‡¥ä¸”ä¹å‘³çš„ã€‚å› æ­¤å¼ºçƒˆå»ºè®®æ‚¨åœ¨é˜…è¯»æœ¬ç³»åˆ—å‰æœ‰ä¸€å®šçš„çŸ¥è¯†å‚¨å¤‡ã€‚ä¾‹å¦‚å®Œæ•´é˜…è¯»è¿‡ Vue2ã€Vue3 ç‰ˆæœ¬å®˜æ–¹æ–‡æ¡£ï¼Œæœ‰ Vue3 å®Œæ•´é¡¹ç›®å¼€å‘ç»éªŒæ›´ä½³ï¼Œè¿™æ ·å¯ä»¥å¯¹ Vue æœ‰ç€æ¸…æ™°çš„è®¤è¯†ã€‚å¦‚æš‚æ—¶ä¸å…·å¤‡ä¸Šè¿°çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå»ºè®®å¯ä»¥åšäº›è®¸æ²‰æ·€ï¼Œå¦‚é˜…è¯»<a href="https://v3.cn.vuejs.org/">Vue3 ç›¸å…³å¼€å‘æ–‡æ¡£</a>ç­‰ã€‚</p><h2 id="ç« èŠ‚åºåˆ—"><a href="#ç« èŠ‚åºåˆ—" class="headerlink" title="ç« èŠ‚åºåˆ—"></a>ç« èŠ‚åºåˆ—</h2><p>Vue3 åœ¨å¼€å‘æœŸé—´ï¼Œå°†ä¸åŒçš„åŠŸèƒ½æ¨¡å—æŠ½ç¦»ä¸ºå•ç‹¬ä¸ªä½“çš„åŒ…ï¼Œåœ¨è§£è€¦çš„åŒæ—¶ä¹Ÿä¾¿äº tree-shaking çš„ä½“ç§¯ä¼˜åŒ–ã€‚å› æ­¤ï¼Œæœ¬ç³»åˆ—ä¹Ÿä¼šæ ¹æ®æ¨¡å—è¿›è¡Œæ·±å…¥ç ”ç©¶ã€‚</p><ol><li>Vue3 æºç ç›®å½•ç»“æ„</li><li>æ·±å…¥ Vue3 å“åº”å¼ç³»ç»Ÿ</li><li>æ·±å…¥ Vue3 ç¼–è¯‘å™¨</li><li>æ·±å…¥ Vue3 åŒæ„æ¸²æŸ“</li></ol><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æœ¬ç³»åˆ—å…¨éƒ¨æºç å‡å¯åœ¨<a href="https://github.com/jiaaoMario/vue3-SC">jiaaoMario&#x2F;vue3-SC</a>ä»“åº“ä¸­æ‰¾åˆ°ï¼Œå¦‚åœ¨å…±åŒå­¦ä¹ ä¸­é‡åˆ°é—®é¢˜æˆ–è§è§£ï¼Œå¯åœ¨ Issues ä¸­åé¦ˆï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥:)</p>]]></content>
    
    
    
    <tags>
      
      <tag>Vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»é›¶æ’¸ä¸€ä¸ª pearReact</title>
    <link href="/2022/01/10/%E4%BB%8E%E9%9B%B6%E6%92%B8%E4%B8%80%E4%B8%AA-pearReact/"/>
    <url>/2022/01/10/%E4%BB%8E%E9%9B%B6%E6%92%B8%E4%B8%80%E4%B8%AA-pearReact/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Promise/A+è§„èŒƒç¿»è¯‘</title>
    <link href="/2021/01/05/Promise-A-%E8%A7%84%E8%8C%83%E7%BF%BB%E8%AF%91/"/>
    <url>/2021/01/05/Promise-A-%E8%A7%84%E8%8C%83%E7%BF%BB%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Promise æ˜¯æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ APIã€‚Promise çš„å‡ºç°ï¼Œè§£å†³äº†è‡­åæ˜­è‘—çš„å›è°ƒåœ°ç‹±å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ã€‚Promise ä½œä¸ºä¸€ä¸ªå­˜å‚¨ç€å¼‚æ­¥è°ƒç”¨å‡½æ•°çš„å®¹å™¨ï¼Œé€šè¿‡ä½¿ç”¨ thenã€catch ç­‰æ–¹æ³•æ³¨å†Œå›è°ƒå®Œæˆåæ‰§è¡Œçš„äº‹ä»¶ï¼Œæå¤§ç¨‹åº¦ä¸Šä¼˜åŒ–äº†å¼‚æ­¥å¼€å‘ä½“éªŒã€‚ç°å¦‚ä»Šçš„ Promise è§„èŒƒä¸­ï¼Œä¸»è¦æ˜¯åœ¨ Promise&#x2F;A+è§„èŒƒä¹‹ä¸Šï¼Œæ‰©å±•äº† allã€raceã€allSettled ç­‰æ–¹æ³•ï¼Œå› æ­¤äº†è§£ Promise&#x2F;A+è§„èŒƒï¼Œæœ‰åˆ©äºæˆ‘ä»¬çŸ¥æ‚‰ Promise çš„åº•å±‚æ‰§è¡Œè¿‡ç¨‹ã€‚</p><h2 id="Promise-x2F-A-è§„èŒƒç¿»è¯‘"><a href="#Promise-x2F-A-è§„èŒƒç¿»è¯‘" class="headerlink" title="Promise&#x2F;A+ è§„èŒƒç¿»è¯‘"></a>Promise&#x2F;A+ è§„èŒƒç¿»è¯‘</h2><h3 id="1-çŠ¶æ€"><a href="#1-çŠ¶æ€" class="headerlink" title="1. çŠ¶æ€"></a>1. çŠ¶æ€</h3><p>Promise å¿…é¡»æ˜¯ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š Pending, Fulfilled, Rejected</p><ul><li>Promise å¤„äº Pending çŠ¶æ€ä¸‹ï¼Œå¯ä»¥è½¬åŒ–ä¸º Fulfilled æˆ–è€… Rejected</li><li>å¦‚æœ Promise å·²å¤„äº Fulfilled æˆ–è€… Rejected çŠ¶æ€ï¼Œåˆ™æ— æ³•ç»§ç»­è¿›è¡ŒçŠ¶æ€è½¬ç§»ã€‚æ­¤æ—¶ Fulfilled å¯¹åº”çš„ valueã€ Rejected å¯¹åº”çš„ reason ä¸å¯å˜åŒ–ã€‚</li></ul><h3 id="2-then-Promise-then-onFulfilled-onRejected"><a href="#2-then-Promise-then-onFulfilled-onRejected" class="headerlink" title="2. then Promise.then(onFulfilled, onRejected)"></a>2. then Promise.then(onFulfilled, onRejected)</h3><p>Promise å¿…é¡»æä¾›ä¸€ä¸ª then æ–¹æ³•ä½œä¸ºæ‰§è¡Œæˆ–è€…è®¢é˜…å¼‚æ­¥å‡½æ•°å®Œæˆåæ‰§è¡Œçš„æ“ä½œ</p><ul><li>onFulfilled ä¸ onRejected ä¸ºå¯é€‰å‚æ•°ã€‚onFulfilled ä¸ onRejected ä»…å¯è¢«åšä¸ºå‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæœªä¼ å…¥æˆ–è€…ä¼ å…¥å€¼ç±»å‹éå‡½æ•°ç±»å‹ï¼Œåˆ™å¿½ç•¥ã€‚</li><li>onFulfilled ä¸ºå‡½æ•°ï¼Œåˆ™ onFulfilled å¿…é¡»åœ¨ Promise çŠ¶æ€è½¬ç§»è‡³ Fulfilled çŠ¶æ€åè¢«è°ƒç”¨ï¼Œä¸”å°†æ¥æ”¶åˆ° value ä½œä¸ºå‡½æ•°å”¯ä¸€å…¥å‚ã€‚</li><li>onRejected ä¸ºå‡½æ•°ï¼Œåˆ™ onRejected å¿…é¡»åœ¨ Promise çŠ¶æ€è½¬ç§»è‡³ Rejected çŠ¶æ€åè¢«è°ƒç”¨ï¼Œä¸”å°†æ¥å—åˆ° reason ä½œä¸ºå‚æ•°å”¯ä¸€å…¥å‚ã€‚</li><li>onFulfilled ä¸ onRejected ä»…èƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>then æ–¹æ³•å¯ä»¥è¢«ä¸€ä¸ª Promise å¤šæ¬¡è°ƒç”¨ï¼Œå½“ Promise çŠ¶æ€å‘ç”Ÿå˜æ›´åï¼Œæ‰€æœ‰çš„ onFulfilled å’Œ onRejected å¿…é¡»æŒ‰ç…§æ³¨å†Œé¡ºåºä¾æ¬¡æ‰§è¡Œ</li><li>then æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œä»¥æ”¯æŒé“¾å¼è°ƒç”¨ã€‚<ul><li>i: onFulfilled æˆ–è€… onRejected è¿”å›ä¸€ä¸ªå€¼ x ï¼Œåˆ™è¿è¡Œ Promise è§£å†³è¿‡ç¨‹ï¼š[[Resolve]](promise2, x)</li><li>ii: å¦‚æœ onFulfilled æˆ–è€… onRejected æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ e ï¼Œåˆ™ promise2 å¿…é¡»æ‹’ç»æ‰§è¡Œï¼Œå¹¶è¿”å›æ‹’å›  e;</li><li>iii: å¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ä¸” promise1 æˆåŠŸæ‰§è¡Œï¼Œ promise2 å¿…é¡»æˆåŠŸæ‰§è¡Œå¹¶è¿”å›ç›¸åŒçš„ value;</li><li>iv: å¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ä¸” promise1 æ‹’ç»æ‰§è¡Œï¼Œ promise2 å¿…é¡»æ‹’ç»æ‰§è¡Œå¹¶è¿”å›ç›¸åŒçš„ reason;</li></ul></li></ul><h3 id="Promise-çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#Promise-çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Promise çš„æ‰§è¡Œè¿‡ç¨‹"></a>Promise çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>Promise è§£å†³è¿‡ç¨‹æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ“ä½œï¼Œå…¶éœ€è¾“å…¥ä¸€ä¸ª promise å’Œä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬è¡¨ç¤ºä¸º [[Resolve]](promise, x)ï¼Œå¦‚æœ x æœ‰ then æ–¹æ³•ä¸”çœ‹ä¸Šå»åƒä¸€ä¸ª Promise ï¼Œè§£å†³ç¨‹åºå³å°è¯•ä½¿ promise æ¥å— x çš„çŠ¶æ€ï¼›å¦åˆ™å…¶ç”¨ x çš„å€¼æ¥æ‰§è¡Œ promise</p><ul><li>å¦‚æœ promise ä¸ x ä¸ºåŒä¸€ä¸ªå€¼ï¼Œåˆ™ä»¥ TypeError å¼‚å¸¸ä½œä¸º reason æ‹’ç» promiseã€‚</li><li>å¦‚æœ x ä¸º Promise æ€ï¼Œå³ x instanceof Promiseï¼Œåˆ™ä½¿ promise æ¥æ”¶ x çš„çŠ¶æ€<ul><li>å¦‚æœ x å¤„äº Pedding æ€ï¼Œ promise éœ€ä¿æŒä¸ºç­‰å¾…æ€ç›´è‡³ x è¢«æ‰§è¡Œæˆ–æ‹’ç»</li><li>å¦‚æœ x å¤„äº Fulfilled çŠ¶æ€ï¼Œç”¨ç›¸åŒçš„ value æ‰§è¡Œ promise</li><li>å¦‚æœ x å¤„äº Reject çŠ¶æ€ï¼Œç”¨ç›¸åŒçš„ reason æ‹’ç» promise</li></ul></li><li>å¦‚æœ x ä¸ºå¯¹è±¡æˆ–è€…å‡½æ•°<ul><li>æŠŠ x.then èµ‹å€¼ç»™ then</li><li>å¦‚æœå– x.then çš„å€¼æ—¶æŠ›å‡ºé”™è¯¯ e ï¼Œåˆ™ä»¥ e ä¸º reason æ‹’ç» promise</li><li>å¦‚æœ then æ˜¯å‡½æ•°ï¼Œå°† x ä½œä¸ºå‡½æ•°çš„ä½œç”¨åŸŸ this è°ƒç”¨ä¹‹ã€‚ä¼ é€’ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å«åš resolvePromise ï¼Œç¬¬äºŒä¸ªå‚æ•°å«åš rejectPromise</li><li>å¦‚æœ resolvePromise ä»¥ y ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™è¿è¡Œ [[Resolve]](promise, y)</li><li>å¦‚æœ rejectPromise ä»¥ r ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™ä»¥ reason r æ‹’ç» promise</li><li>å¦‚æœ resolvePromise å’Œ rejectPromise å‡è¢«è°ƒç”¨ï¼Œæˆ–è€…è¢«åŒä¸€å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨é¦–æ¬¡è°ƒç”¨å¹¶å¿½ç•¥å‰©ä¸‹çš„è°ƒç”¨</li><li>å¦‚æœè°ƒç”¨ then æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ e: å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œåˆ™å¿½ç•¥ä¹‹;å¦åˆ™ä»¥ e ä¸º reason æ‹’ç» promise;</li><li>å¦‚æœ then ä¸æ˜¯å‡½æ•°ï¼Œä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise</li></ul></li><li>å¦‚æœ x ä¸ä¸ºå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œåˆ™ä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ Promise;</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Promise</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
